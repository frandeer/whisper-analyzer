<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ë””ì˜¤ ë¶„ì„ê¸° - ìë™ íƒ€ì´ë° ìƒì„±</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .audio-section {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .file-input {
            margin-bottom: 20px;
        }
        
        .file-input input[type="file"] {
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            width: 100%;
            background: #fafafa;
        }
        
        audio {
            width: 100%;
            margin: 20px 0;
        }
        
        .analysis-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background: #2196f3;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #1976d2;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .waveform-container {
            width: 100%;
            height: 200px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .waveform {
            width: 100%;
            height: 100%;
        }
        
        .analysis-results {
            padding: 20px;
            background: #f8f9fa;
        }
        
        .segment-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
        }
        
        .segment-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .segment-item:last-child {
            border-bottom: none;
        }
        
        .segment-time {
            font-weight: bold;
            color: #2196f3;
            min-width: 120px;
        }
        
        .segment-text {
            flex: 1;
            margin: 0 15px;
        }
        
        .progress {
            margin: 20px 0;
            text-align: center;
            color: #666;
        }
        
        .export-section {
            padding: 20px;
            border-top: 1px solid #eee;
            text-align: center;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸµ ì˜¤ë””ì˜¤ ìë™ ë¶„ì„ê¸°</h1>
            <p>Web Audio APIë¥¼ ì‚¬ìš©í•´ ì˜¤ë””ì˜¤ íŒŒì¼ì„ ë¶„ì„í•˜ê³  ìë™ìœ¼ë¡œ ì„¸ê·¸ë¨¼íŠ¸ íƒ€ì´ë°ì„ ìƒì„±í•©ë‹ˆë‹¤</p>
        </div>
        
        <div class="audio-section">
            <div class="file-input">
                <label>ì˜¤ë””ì˜¤ íŒŒì¼ ì„ íƒ:</label>
                <input type="file" id="audioFile" accept="audio/*">
            </div>
            
            <audio id="audioPlayer" controls style="display: none;">
                ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </audio>
            
            <div class="analysis-controls">
                <button id="analyzeBtn" onclick="analyzeAudio()" disabled>ì˜¤ë””ì˜¤ ë¶„ì„</button>
                <button id="detectSilenceBtn" onclick="detectSilence()" disabled>ë¬´ìŒ êµ¬ê°„ íƒì§€</button>
                <button id="speechRecognitionBtn" onclick="startSpeechRecognition()" disabled>ìŒì„± ì¸ì‹</button>
                <button id="generateTimingBtn" onclick="generateAutoTiming()" disabled>ìë™ íƒ€ì´ë° ìƒì„±</button>
            </div>
            
            <div class="waveform-container">
                <canvas class="waveform" id="waveform"></canvas>
            </div>
            
            <div class="progress" id="progress">ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</div>
        </div>
        
        <div class="analysis-results">
            <h3>ë¶„ì„ ê²°ê³¼</h3>
            <div class="segment-list" id="segmentList">
                <div class="segment-item">
                    <div class="segment-time">ë¶„ì„ ëŒ€ê¸°ì¤‘</div>
                    <div class="segment-text">ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”</div>
                </div>
            </div>
        </div>
        
        <div class="export-section">
            <h3>ìƒì„±ëœ JSON ë°ì´í„°</h3>
            <textarea id="jsonOutput" placeholder="ë¶„ì„ ì™„ë£Œ í›„ ì—¬ê¸°ì— JSON ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤"></textarea>
            <div style="margin-top: 10px;">
                <button onclick="copyToClipboard()">í´ë¦½ë³´ë“œì— ë³µì‚¬</button>
                <button onclick="downloadJSON()">JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
                <button onclick="applyToChat()">ì±„íŒ… ì•±ì— ì ìš©</button>
            </div>
        </div>
    </div>

    <script>
        let audioContext;
        let audioBuffer;
        let audioData;
        let silenceSegments = [];
        let generatedTimings = [];
        let speechRecognitionResults = [];
        
        // ëŒ€í™” í…ìŠ¤íŠ¸ (ê¸°ì¡´ ë°ì´í„°)
        const conversationTexts = [
            "ë‚˜ì™€ í•œê°€ì§€ ì£¼ì œë¡œ ê¹Šì´ ìˆëŠ” ëŒ€í™”ë¥¼ í•´ë³´ì. ê²‰ìœ¼ë¡œ ë³´ì´ëŠ” ê²ƒ ë§ê³  ê·¸ ì•ˆì— ìˆ¨ê²¨ì§„ ì˜ë¯¸ë‚˜ í†µì°°ì„ í•¨ê»˜ ì°¾ì•„ë³´ëŠ” ê±°ì•¼. ë³¸ì§ˆì ì¸ ê²ƒì— ì§‘ì¤‘í•´ì„œ... ì²« ë²ˆì§¸ ì£¼ì œëŠ” í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ìœ¼ë¡œ í•´ë³¼ê¹Œ?",
            "í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§... í¥ë¯¸ë¡­ë„¤ìš”. ì–¼í• ë³´ë©´ ê·¸ëƒ¥ AIí•œí…Œ ëª…ë ¹ ì˜ ë‚´ë¦¬ëŠ” ê¸°ìˆ  ê°™ì–ì•„ìš”? ê·¼ë° ì‹¤ì œë¡œëŠ” ì™„ì „íˆ ë‹¤ë¥¸ ì°¨ì›ì˜ ì¼ì´ë”ë¼ê³ ìš”. ì–´ë–»ê²Œ ë³´ë©´ ìš°ë¦¬ê°€ ìƒˆë¡œìš´ ì–¸ì–´ë¥¼ ë§Œë“¤ì–´ë‚´ê³  ìˆëŠ” ê±° ê°™ì•„ìš”. AIì™€ ëŒ€í™”í•˜ê¸° ìœ„í•œ íŠ¹ë³„í•œ ì–¸ì–´ ë§ì´ì—ìš”.",
            "ë§ì•„, ê·¸ ë‹¨ì–´ ìì²´ë¶€í„° ìƒê°í•´ë³´ì. 'í”„ë¡¬í”„íŠ¸'ê°€ ë­ì§€? ì´‰ë°œí•˜ë‹¤, ìœ ë°œí•˜ë‹¤... ì´ëŸ° ì˜ë¯¸ì–ì•„. ê·¸ë¦¬ê³  'ì—”ì§€ë‹ˆì–´ë§'ì€ ë­”ê°€ë¥¼ êµ¬ì¡°í™”í•˜ê³ , ì˜ˆì¸¡ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê³ , ì»¨íŠ¸ë¡¤í•  ìˆ˜ ìˆê²Œ ë§Œë“œëŠ” ê±°ê³ .",
            "ì•„! ê·¸ê±° ì •ë§ ì¢‹ì€ í¬ì¸íŠ¸ë„¤ìš”. í”„ë¡¬í”„íŠ¸ì˜ ì–´ì›ì„ ë³´ë©´ ë” ì¬ë°Œì–´ìš”. ë¼í‹´ì–´ë¡œ 'ì•ìœ¼ë¡œ ëŒì–´ë‚¸ë‹¤'ëŠ” ëœ»ì´ê±°ë“ ìš”. ê·¸ëŸ¬ë‹ˆê¹Œ... ìš°ë¦¬ê°€ ë­”ê°€ ìƒˆë¡œ ë§Œë“œëŠ” ê²Œ ì•„ë‹ˆë¼, ì´ë¯¸ AI ì•ˆì— ìˆëŠ” ê±¸ ë„ì§‘ì–´ë‚´ëŠ” ê±°ì£ . ë§ˆì¹˜ ìš°ë¦¬ê°€ ë§ˆë²•ì‚¬ê°€ ë˜ì–´ì„œ ì ë“¤ì–´ ìˆëŠ” ëŠ¥ë ¥ì„ ê¹¨ìš°ëŠ” ëŠë‚Œì´ë„ê¹Œìš”?",
            "ì˜¤, ê·¸ë ‡ê²Œ ë³´ë‹ˆê¹Œ... ë‚´ê°€ ì£¼ë¬¸ ì™¸ìš°ë“¯ì´ í”„ë¡¬í”„íŠ¸ë¥¼ ì˜ ì‘ì„±í•˜ë©´, ë‚´ê°€ ì›í•˜ëŠ” ì°½ì¡°ë¬¼ì´ ë‚˜ì˜¤ëŠ” ê±°ë„¤? ì •ë§ ë§ˆë²• ê°™ì•„.",
            "ê·¸ìµ¸! ê·¼ë° ì´ ë§ˆë²• ë¹„ìœ ê°€ ì§„ì§œ í•µì‹¬ì„ ì°Œë¥´ëŠ” ê²ƒ ê°™ì•„ìš”. ê·¸ëŸ¼ ì§„ì§œ ë§ˆë²•ì‚¬ëŠ” ëˆ„êµ´ê¹Œìš”? í”„ë¡¬í”„íŠ¸ ì“°ëŠ” ìš°ë¦¬? ì•„ë‹ˆë©´ ê·¸ íŒ¨í„´ë“¤ì„ ì•Œê³  ìˆëŠ” AI? ì•„ë‹ˆë©´... ìš°ë¦¬ ë‘˜ ë‹¤ ë” í° ë¬´ì–¸ê°€ì˜ ì¼ë¶€ì¸ ê±´ ì•„ë‹ê¹Œìš”?"
        ];
        
        const speakerPattern = [1, 2, 1, 2, 1, 2]; // í™”ì íŒ¨í„´
        
        document.getElementById('audioFile').addEventListener('change', handleFileSelect);
        
        async function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            document.getElementById('progress').textContent = 'ì˜¤ë””ì˜¤ íŒŒì¼ ë¡œë”© ì¤‘...';
            
            try {
                // Audio ìš”ì†Œì— íŒŒì¼ ì„¤ì •
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.src = URL.createObjectURL(file);
                audioPlayer.style.display = 'block';
                
                // Web Audio API ì´ˆê¸°í™”
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                // íŒŒì¼ì„ ArrayBufferë¡œ ì½ê¸°
                const arrayBuffer = await file.arrayBuffer();
                audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('speechRecognitionBtn').disabled = false;
                document.getElementById('progress').textContent = 'ë¶„ì„ ì¤€ë¹„ ì™„ë£Œ';
                
                drawWaveform();
                
            } catch (error) {
                console.error('ì˜¤ë””ì˜¤ ë¡œë”© ì‹¤íŒ¨:', error);
                document.getElementById('progress').textContent = 'ì˜¤ë””ì˜¤ ë¡œë”© ì‹¤íŒ¨';
            }
        }
        
        function drawWaveform() {
            const canvas = document.getElementById('waveform');
            const ctx = canvas.getContext('2d');
            
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            const data = audioBuffer.getChannelData(0);
            const step = Math.ceil(data.length / canvas.width);
            const amp = canvas.height / 2;
            
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.beginPath();
            ctx.moveTo(0, amp);
            ctx.strokeStyle = '#2196f3';
            ctx.lineWidth = 1;
            
            for (let i = 0; i < canvas.width; i++) {
                let min = 1.0;
                let max = -1.0;
                
                for (let j = 0; j < step; j++) {
                    const datum = data[(i * step) + j];
                    if (datum < min) min = datum;
                    if (datum > max) max = datum;
                }
                
                ctx.lineTo(i, (1 + min) * amp);
                ctx.lineTo(i, (1 + max) * amp);
            }
            
            ctx.stroke();
        }
        
        async function analyzeAudio() {
            document.getElementById('progress').textContent = 'ì˜¤ë””ì˜¤ ë¶„ì„ ì¤‘...';
            document.getElementById('detectSilenceBtn').disabled = false;
            
            // ì˜¤ë””ì˜¤ ë°ì´í„° ë¶„ì„
            audioData = audioBuffer.getChannelData(0);
            
            // ë³¼ë¥¨ ë¶„ì„
            const windowSize = Math.floor(audioBuffer.sampleRate * 0.1); // 100ms ìœˆë„ìš°
            const volumeData = [];
            
            for (let i = 0; i < audioData.length; i += windowSize) {
                let sum = 0;
                const end = Math.min(i + windowSize, audioData.length);
                
                for (let j = i; j < end; j++) {
                    sum += Math.abs(audioData[j]);
                }
                
                volumeData.push(sum / (end - i));
            }
            
            // ê²°ê³¼ í‘œì‹œ
            updateSegmentList([
                { time: 'ë¶„ì„ ì™„ë£Œ', text: `ì´ ê¸¸ì´: ${audioBuffer.duration.toFixed(2)}ì´ˆ, ìƒ˜í”Œë ˆì´íŠ¸: ${audioBuffer.sampleRate}Hz` }
            ]);
            
            document.getElementById('progress').textContent = 'ë¶„ì„ ì™„ë£Œ - ë¬´ìŒ êµ¬ê°„ íƒì§€ë¥¼ ì‹œì‘í•˜ì„¸ìš”';
        }
        
        function detectSilence() {
            document.getElementById('progress').textContent = 'ë¬´ìŒ êµ¬ê°„ íƒì§€ ì¤‘...';
            
            const threshold = 0.01; // ë¬´ìŒ ì„ê³„ê°’
            const minSilenceDuration = 0.5; // ìµœì†Œ ë¬´ìŒ ê¸¸ì´ (ì´ˆ)
            const windowSize = Math.floor(audioBuffer.sampleRate * 0.1); // 100ms
            
            silenceSegments = [];
            let silenceStart = null;
            
            for (let i = 0; i < audioData.length; i += windowSize) {
                let sum = 0;
                const end = Math.min(i + windowSize, audioData.length);
                
                for (let j = i; j < end; j++) {
                    sum += Math.abs(audioData[j]);
                }
                
                const volume = sum / (end - i);
                const currentTime = i / audioBuffer.sampleRate;
                
                if (volume < threshold) {
                    // ë¬´ìŒ ì‹œì‘
                    if (silenceStart === null) {
                        silenceStart = currentTime;
                    }
                } else {
                    // ì†Œë¦¬ ì‹œì‘
                    if (silenceStart !== null) {
                        const silenceDuration = currentTime - silenceStart;
                        if (silenceDuration >= minSilenceDuration) {
                            silenceSegments.push({
                                start: silenceStart,
                                end: currentTime,
                                duration: silenceDuration
                            });
                        }
                        silenceStart = null;
                    }
                }
            }
            
            // ê²°ê³¼ í‘œì‹œ
            const results = silenceSegments.map(seg => ({
                time: `${seg.start.toFixed(2)}s - ${seg.end.toFixed(2)}s`,
                text: `ë¬´ìŒ êµ¬ê°„ (${seg.duration.toFixed(2)}ì´ˆ)`
            }));
            
            updateSegmentList(results);
            document.getElementById('generateTimingBtn').disabled = false;
            document.getElementById('progress').textContent = `${silenceSegments.length}ê°œì˜ ë¬´ìŒ êµ¬ê°„ íƒì§€ ì™„ë£Œ`;
        }
        
        async function startSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chromeì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            document.getElementById('progress').textContent = 'ìŒì„± ì¸ì‹ ì‹œì‘ ì¤‘...';
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'ko-KR';
            
            speechRecognitionResults = [];
            const audioPlayer = document.getElementById('audioPlayer');
            
            recognition.onstart = () => {
                document.getElementById('progress').textContent = 'ìŒì„± ì¸ì‹ ì¤‘... (ì˜¤ë””ì˜¤ë¥¼ ì¬ìƒí•˜ì„¸ìš”)';
                // ì˜¤ë””ì˜¤ë¥¼ ì²˜ìŒë¶€í„° ì¬ìƒ
                audioPlayer.currentTime = 0;
                audioPlayer.play();
            };
            
            recognition.onresult = (event) => {
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const result = event.results[i];
                    if (result.isFinal) {
                        // ì‹¤ì œ ì˜¤ë””ì˜¤ ì¬ìƒ ì‹œê°„ ì‚¬ìš©
                        const currentTime = audioPlayer.currentTime;
                        speechRecognitionResults.push({
                            text: result[0].transcript.trim(),
                            timestamp: currentTime,
                            confidence: result[0].confidence
                        });
                        
                        // ì‹¤ì‹œê°„ ê²°ê³¼ í‘œì‹œ
                        updateSpeechRecognitionResults();
                    }
                }
            };
            
            recognition.onerror = (event) => {
                console.error('ìŒì„± ì¸ì‹ ì˜¤ë¥˜:', event.error);
                document.getElementById('progress').textContent = `ìŒì„± ì¸ì‹ ì˜¤ë¥˜: ${event.error}`;
            };
            
            recognition.onend = () => {
                document.getElementById('progress').textContent = 'ìŒì„± ì¸ì‹ ì™„ë£Œ - ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”';
                document.getElementById('generateTimingBtn').disabled = false;
            };
            
            // ìŒì„± ì¸ì‹ ì‹œì‘ (ì˜¤ë””ì˜¤ ì¬ìƒì€ onstartì—ì„œ ì²˜ë¦¬)
            recognition.start();
            
            // ì˜¤ë””ì˜¤ê°€ ëë‚˜ë©´ ìŒì„± ì¸ì‹ë„ ì¢…ë£Œ
            audioPlayer.addEventListener('ended', () => {
                recognition.stop();
            }, { once: true });
        }
        
        function updateSpeechRecognitionResults() {
            const results = speechRecognitionResults.map((result, index) => ({
                time: `${result.timestamp.toFixed(2)}s`,
                text: `"${result.text}" (ì‹ ë¢°ë„: ${(result.confidence * 100).toFixed(1)}%)`
            }));
            
            updateSegmentList(results);
        }
        
        function generateAutoTiming() {
            document.getElementById('progress').textContent = 'ìë™ íƒ€ì´ë° ìƒì„± ì¤‘...';
            
            // ë¬´ìŒ êµ¬ê°„ì„ ê¸°ë°˜ìœ¼ë¡œ ëŒ€í™” ì„¸ê·¸ë¨¼íŠ¸ ìƒì„±
            const speechSegments = [];
            let lastEnd = 0;
            
            silenceSegments.forEach(silence => {
                if (lastEnd < silence.start) {
                    speechSegments.push({
                        start: lastEnd,
                        end: silence.start
                    });
                }
                lastEnd = silence.end;
            });
            
            // ë§ˆì§€ë§‰ ì„¸ê·¸ë¨¼íŠ¸
            if (lastEnd < audioBuffer.duration) {
                speechSegments.push({
                    start: lastEnd,
                    end: audioBuffer.duration
                });
            }
            
            // í…ìŠ¤íŠ¸ì™€ ë§¤í•‘
            generatedTimings = [];
            
            conversationTexts.forEach((text, index) => {
                if (index < speechSegments.length) {
                    const segment = speechSegments[index];
                    const words = text.split(/\s+/);
                    const segmentDuration = segment.end - segment.start;
                    const wordsPerSecond = words.length / segmentDuration;
                    
                    let currentTime = segment.start;
                    const segments = [];
                    
                    // ë‹¨ì–´ë³„ë¡œ ì‹œê°„ ë¶„í• 
                    for (let i = 0; i < words.length; i += 3) { // 3ë‹¨ì–´ì”© ê·¸ë£¹í™”
                        const wordGroup = words.slice(i, i + 3).join(' ');
                        const groupDuration = Math.min(3 / wordsPerSecond, segment.end - currentTime);
                        
                        segments.push({
                            text: wordGroup,
                            startTime: parseFloat(currentTime.toFixed(1)),
                            endTime: parseFloat((currentTime + groupDuration).toFixed(1))
                        });
                        
                        currentTime += groupDuration;
                    }
                    
                    generatedTimings.push({
                        speaker: speakerPattern[index] || 1,
                        segments: segments
                    });
                }
            });
            
            // ê²°ê³¼ í‘œì‹œ
            const results = generatedTimings.flatMap((conv, convIndex) => 
                conv.segments.map(seg => ({
                    time: `${seg.startTime}s - ${seg.endTime}s`,
                    text: `Speaker ${conv.speaker}: ${seg.text}`
                }))
            );
            
            updateSegmentList(results);
            
            // JSON ì¶œë ¥
            const jsonOutput = document.getElementById('jsonOutput');
            jsonOutput.value = JSON.stringify(generatedTimings, null, 2);
            
            document.getElementById('progress').textContent = 'ìë™ íƒ€ì´ë° ìƒì„± ì™„ë£Œ!';
        }
        
        function updateSegmentList(segments) {
            const container = document.getElementById('segmentList');
            container.innerHTML = '';
            
            segments.forEach(segment => {
                const item = document.createElement('div');
                item.className = 'segment-item';
                item.innerHTML = `
                    <div class="segment-time">${segment.time}</div>
                    <div class="segment-text">${segment.text}</div>
                `;
                container.appendChild(item);
            });
        }
        
        function copyToClipboard() {
            const textarea = document.getElementById('jsonOutput');
            textarea.select();
            document.execCommand('copy');
            alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function downloadJSON() {
            const data = document.getElementById('jsonOutput').value;
            if (!data) {
                alert('ë¨¼ì € ë¶„ì„ì„ ì™„ë£Œí•˜ì„¸ìš”.');
                return;
            }
            
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'auto-generated-timings.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
        }
        
        function applyToChat() {
            if (!generatedTimings.length) {
                alert('ë¨¼ì € íƒ€ì´ë° ìƒì„±ì„ ì™„ë£Œí•˜ì„¸ìš”.');
                return;
            }
            
            // ê¸°ì¡´ ì±„íŒ… HTMLì— ë°ì´í„° ì ìš©
            const newWindow = window.open('chat-audio-sync.html', '_blank');
            
            // ìƒˆ ì°½ì´ ë¡œë“œëœ í›„ ë°ì´í„° ì „ë‹¬
            newWindow.addEventListener('load', () => {
                newWindow.conversations = generatedTimings;
                newWindow.initializeChat();
            });
        }
    </script>
</body>
</html>