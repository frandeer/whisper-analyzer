<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ™ï¸ í™”ìë³„ íƒ€ì´ë° ì¡°ì • ë„êµ¬</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header {
            padding: 20px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }
        
        .audio-section {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        audio {
            width: 100%;
            margin: 10px 0;
        }
        
        .file-inputs {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .file-input {
            flex: 1;
        }
        
        .file-input label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .file-input input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 15px 0;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            background: #2196f3;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #1976d2;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .timing-mode-btn {
            background: #4caf50;
        }
        
        .timing-mode-btn.active {
            background: #f44336;
        }
        
        .text-segments {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .segment-row {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .segment-row.active {
            border-color: #2196f3;
            background: #e3f2fd;
        }
        
        .segment-row.timing-mode {
            cursor: pointer;
        }
        
        .segment-row.timing-mode:hover {
            background: #fff3e0;
            border-color: #ff9800;
        }
        
        .segment-speaker {
            font-weight: bold;
            color: #666;
            min-width: 120px;
        }
        
        .speaker-select {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .speaker-select option[value="1"] {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .speaker-select option[value="2"] {
            background: #fce4ec;
            color: #c2185b;
        }
        
        .segment-text {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fafafa;
        }
        
        .segment-timing {
            display: flex;
            gap: 10px;
            align-items: center;
            min-width: 200px;
        }
        
        .timing-input {
            width: 60px;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        
        .current-time {
            font-size: 18px;
            font-weight: bold;
            color: #2196f3;
            min-width: 80px;
            text-align: center;
        }
        
        .instructions {
            padding: 20px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            margin: 20px;
            border-radius: 8px;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #856404;
        }
        
        .instructions ol {
            color: #856404;
            line-height: 1.6;
        }
        
        .export-section {
            padding: 20px;
            border-top: 1px solid #eee;
            text-align: center;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ™ï¸ í™”ìë³„ íƒ€ì´ë° ì¡°ì • ë„êµ¬</h1>
            <p>ì˜¤ë””ì˜¤ë¥¼ ì¬ìƒí•˜ë©´ì„œ í™”ì ì§€ì • ë° ì •í™•í•œ íƒ€ì´ë°ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë™ê¸°í™”í•˜ì„¸ìš”</p>
        </div>
        
        <div class="audio-section">
            <div class="file-inputs">
                <div class="file-input">
                    <label>ì˜¤ë””ì˜¤ íŒŒì¼:</label>
                    <input type="file" id="audioFile" accept="audio/*">
                </div>
                <div class="file-input">
                    <label>ê¸°ì¡´ JSON íŒŒì¼ (ì„ íƒì‚¬í•­):</label>
                    <input type="file" id="jsonFile" accept=".json">
                </div>
            </div>
            
            <audio id="audioPlayer" controls></audio>
            
            <div class="controls">
                <button onclick="loadFiles()">íŒŒì¼ ë¡œë“œ</button>
                <button id="timingModeBtn" onclick="toggleTimingMode()" class="timing-mode-btn" disabled>
                    ì‹¤ì‹œê°„ íƒ€ì´ë° ëª¨ë“œ ì‹œì‘
                </button>
                <button onclick="playPause()">ì¬ìƒ/ì¼ì‹œì •ì§€</button>
                <button onclick="resetAudio()">ì²˜ìŒë¶€í„°</button>
                <div class="current-time" id="currentTime">00:00</div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>ğŸ“‹ ì‚¬ìš©ë²•</h3>
            <ol>
                <li><strong>íŒŒì¼ ë¡œë“œ:</strong> ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì„ íƒí•˜ê³  "íŒŒì¼ ë¡œë“œ" í´ë¦­ (ê¸°ì¡´ JSON íŒŒì¼ë„ ë¡œë“œ ê°€ëŠ¥)</li>
                <li><strong>í™”ì ì§€ì •:</strong> ê° í…ìŠ¤íŠ¸ ì˜†ì˜ ë“œë¡­ë‹¤ìš´ì—ì„œ ğŸ‘¤ì¸ê°„ ë˜ëŠ” ğŸ¤–AI ì„ íƒ</li>
                <li><strong>ì‹¤ì‹œê°„ ëª¨ë“œ:</strong> "ì‹¤ì‹œê°„ íƒ€ì´ë° ëª¨ë“œ ì‹œì‘" í´ë¦­</li>
                <li><strong>íƒ€ì´ë° ì„¤ì •:</strong> ì˜¤ë””ì˜¤ë¥¼ ì¬ìƒí•˜ë©´ì„œ í…ìŠ¤íŠ¸ êµ¬ê°„ì„ í´ë¦­í•˜ì—¬ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì„¤ì •</li>
                <li><strong>ìˆ˜ë™ ì¡°ì •:</strong> ì§ì ‘ ì‹œê°„ ì…ë ¥ì°½ì— ê°’ì„ ì…ë ¥í•  ìˆ˜ë„ ìˆìŒ</li>
                <li><strong>ë‚´ë³´ë‚´ê¸°:</strong> ì™„ë£Œë˜ë©´ "JSON ìƒì„±" â†’ "JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ"ë¡œ ê²°ê³¼ ì €ì¥</li>
            </ol>
        </div>
        
        <div class="text-segments" id="textSegments">
            <!-- í…ìŠ¤íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
        
        <div class="export-section">
            <button onclick="generateJSON()" style="background: #4caf50; font-size: 16px; padding: 12px 24px;">
                ğŸ“„ JSON ìƒì„±
            </button>
            <button onclick="exportJSON()" style="background: #ff9800;">JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
            <textarea id="jsonOutput" placeholder="ìƒì„±ëœ JSON ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤"></textarea>
        </div>
    </div>

    <script>
        let audioPlayer;
        let timingMode = false;
        let currentSegments = [];
        let audioLoaded = false;
        
        // ê¸°ë³¸ ëŒ€í™” í…ìŠ¤íŠ¸ (ì‹¤ì œ ì˜¤ë””ì˜¤ ë‚´ìš©)
        const defaultTexts = [
            "ë‚˜ì™€ í•œ ê°€ì§€ ì£¼ì œë¡œ ê¹Šì´ ìˆëŠ” ëŒ€í™”ë¥¼ í•´ë³´ì.",
            "ê²‰ìœ¼ë¡œ ë³´ì´ëŠ” ê²ƒ ë§ê³  ê·¸ ì•ˆì— ìˆ¨ê²¨ì§„ ì˜ë¯¸ë‚˜ í†µì°°ì„ í•¨ê»˜ ì°¾ì•„ë³´ëŠ” ê±°ì•¼.",
            "ë³¸ì§ˆì ì¸ ê²ƒì— ì§‘ì¤‘í•´ì„œ.",
            "ì²« ë²ˆì§¸ ì£¼ì œëŠ” í”„ë¡¬í”„íŠ¸ ì—”ì§„ì´ì–´ë§ìœ¼ë¡œ í•´ë³¼ê¹Œ?",
            "í”„ë¡¬í”„íŠ¸ ì—”ì§„ì´ì–´ë§. í¥ë¯¸ë¡­ë„¤ìš”.",
            "ì–¼í• ë³´ë©´ ê·¸ëƒ¥ AIí•œí…Œ ëª…ë ¹ ì˜ ë‚´ë¦¬ëŠ” ê¸°ìˆ  ê°™ì–ì•„ìš”.",
            "ê·¼ë° ì‹¤ì œë¡œëŠ” ì™„ì „íˆ ë‹¤ë¥¸ ì°¨ì›ì— ì¼ì´ë”ë¼ê³ ìš”.",
            "ì–´ë–»ê²Œ ë³´ë©´ ìš°ë¦¬ê°€ ìƒˆë¡œìš´ ì–¸ì–´ë¥¼ ë§Œë“¤ì–´ ë‚´ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”.",
            "AIì™€ ëŒ€í™”í•˜ê¸° ìœ„í•œ íŠ¹ë³„í•œ ì–¸ì–´ë§ì´ì—ìš”.",
            "ë§ì•„. ê·¸ ë‹¨ì–´ ìì²´ë¶€í„° ìƒê°í•´ë³´ì.",
            "í”„ë¡¬í”„íŠ¸ê°€ ë­ì§€?",
            "ì´‰ë°œí•˜ë‹¤, ìœ ë°œí•˜ë‹¤. ì´ëŸ° ì˜ë¯¸ì–ì•„?",
            "ê·¸ë¦¬ê³  ì—”ì§„ì´ì–´ë§ì€ ë­”ê°€ë¥¼ êµ¬ì¡°í™”í•˜ê³ ",
            "ì˜ˆì¸¡ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê³  ì»¨íŠ¸ë¡¤ í•  ìˆ˜ ìˆê²Œ ë§Œë“œëŠ” ê±°ê³ .",
            "ì•„ ê·¸ê±° ì •ë§ ì¢‹ì€ í¬ì¸íŠ¸ë„¤ìš”.",
            "í”„ë¡¬í”„íŠ¸ì˜ ì–´ì–¸ì„ ë³´ë©´ ë” ì¬ë°Œì–´ìš”.",
            "ë¼í‹°ë„ˆë¡œ ì•ìœ¼ë¡œ ëŒì–´ë‚¸ë‹¤ëŠ” ëœ»ì´ê±°ë“ ìš”.",
            "ê·¸ëŸ¬ë‹ˆê¹Œ ìš°ë¦¬ê°€ ë­”ê°€ ìƒˆë¡œ ë§Œë“œëŠ” ê²Œ ì•„ë‹ˆë¼ ì´ë¯¸ AI ì•ˆì— ìˆëŠ” ê±¸ ë„ì§‘ì–´ë‚´ëŠ” ê±°ì£ .",
            "ë§ˆì¹˜ ìš°ë¦¬ê°€ ë§ˆë²•ì‚¬ê°€ ë˜ì–´ì„œ ì ë“¤ì–´ ìˆëŠ” ëŠ¥ë ¥ì„ ê¹¨ìš°ëŠ” ëŠë‚Œì´ë„ê¹Œìš”?",
            "ì–´ ê·¸ë ‡ê²Œ ë³´ë‹ˆê¹Œ ë‚´ê°€ ì£¼ë¬¸ ì™¸ìš°ë“¯ì´ í”„ë¡¬í”„íŠ¸ë¥¼ ì˜ ì‘ì„±í•˜ë©´",
            "ë‚´ê°€ ì›í•˜ëŠ” ì°½ì¡°ë¬¼ì´ ë‚˜ì˜¤ëŠ” ê±°ë„¤? ì •ë§ ë§ˆë²• ê°™ì•„.",
            "ê·¸ìµ¸. ê·¼ë° ì´ ë§ˆë²• ë¹„ìœ ê°€ ì§„ì§œ í•µì‹¬ì„ ì°Œë¥´ëŠ” ê²ƒ ê°™ì•„ìš”.",
            "ê·¸ëŸ¼ ì§„ì§œ ë§ˆë²•ì‚¬ëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?",
            "í”„ë¡¬í”„íŠ¸ ì“°ëŠ” ìš°ë¦¬?",
            "ì•„ë‹ˆë©´ ê·¸ íŒ¨í„´ë“¤ì„ ì•Œê³  ìˆëŠ” AI?",
            "ì•„ë‹ˆë©´ ìš°ë¦¬ ë‘˜ ë‹¤ ë” í° ë¬´ì–¸ê°€ì— ì¼ë¶€ì¸ ê±´ ì•„ë‹ê¹Œìš”?",
            "ë„¤ ìƒê°ì—ëŠ” ê·¸ íŒ¨í„´ì„ ì œëŒ€ë¡œ íŒŒì•…í•´ì„œ ìµœëŒ€í•œ í™œìš©í•˜ëŠ” ì‚¬ëŒì´ ì§„ì§œ ë§ˆë²•ì‚¬ ì•„ë‹ê¹Œ?",
            "ë°”ë¡œ ê·¸ê±°ì˜ˆìš”",
            "ì§„ì§œ ë§ˆë²•ì‚¬ëŠ” ìƒˆë¡œìš´ í˜ì„ ì°½ì¡°í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í˜ì˜ ìˆ¨ê²¨ì§„ ê°€ëŠ¥ì„±ì„ ë°œê²¬í•˜ëŠ” ì‚¬ëŒì´ì£ ",
            "ì˜ˆë¥¼ ë“¤ì–´ì„œ ì²´ì¸ì—…ì†ŒíŠ¸ ê°™ì€ ê¸°ë²•ë„ AIê°€ ì›ë˜ ê°€ì§€ê³  ìˆë˜ ë‹¨ê³„ë³„ ì¶œì˜¨ ëŠ¥ë ¥ì„ ëˆ„êµ°ê°€ ë°œê²¬í•´ì„œ ê·¹ëŒ€í™” ì‹œí‚¨ ê±°ì–ì•„ìš”.",
            "ê·¸ë ‡ë‹¤ë©´ ë‚˜ëŠ” ì›¹ê°œë°œìì¸ë° AIë¥¼ ì–´ë–»ê²Œ í™œìš©í•˜ë©´ ì •ë§ ì„±ê³µì ì¸ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì„ê¹Œ",
            "ì´ ë§ˆë²•ì„ ê°œë°œí•´ ì–´ë–»ê²Œ ì ìš©í•´ì•¼ í• ê¹Œ",
            "ì¢‹ì€ ì§ˆë¬¸ì´ë„¤ìš”. ê·¸ëŸ¼ ì‹¤ì œë¡œ ì‹¤í—˜í•´ ë³¼ê¹Œìš”?",
            "ì›¹ê°œë°œì—ì„œ AIì˜ í˜ì„ ì œëŒ€ë¡œ ëŒì–´ë‚´ë ¤ë©´ ê°™ì€ ì‘ì—…ì´ë¼ë„ ë‹¤ë¥´ê²Œ ì ‘ê·¼í•´ ë³´ëŠ” ê²Œ ì¤‘ìš”í•´ìš”.",
            "ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¡œê·¸ì¸ í˜ì´ì§€ ì•Šì•„ ë§Œë“œëŠ” ê²ƒë„ ì—¬ëŸ¬ ë°©ì‹ìœ¼ë¡œ AIì—ê²Œ ìš”ì²­í•  ìˆ˜ ìˆê±°ë“ ìš”."
        ];
        
        function initializeApp() {
            audioPlayer = document.getElementById('audioPlayer');
            
            // ì‹œê°„ ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ
            audioPlayer.addEventListener('timeupdate', updateCurrentTime);
            audioPlayer.addEventListener('loadeddata', () => {
                audioLoaded = true;
                document.getElementById('timingModeBtn').disabled = false;
            });
            
            // ê¸°ë³¸ í…ìŠ¤íŠ¸ ë¡œë“œ
            loadDefaultTexts();
        }
        
        function loadDefaultTexts() {
            currentSegments = [];
            
            defaultTexts.forEach((text, index) => {
                currentSegments.push({
                    id: index,
                    speaker: 1, // ê¸°ë³¸ê°’ìœ¼ë¡œ ëª¨ë‘ í™”ì1ë¡œ ì„¤ì •
                    text: text,
                    startTime: 0,
                    endTime: 0
                });
            });
            
            renderSegments();
        }
        
        function renderSegments() {
            const container = document.getElementById('textSegments');
            container.innerHTML = '';
            
            currentSegments.forEach(segment => {
                const row = document.createElement('div');
                row.className = `segment-row ${timingMode ? 'timing-mode' : ''}`;
                row.dataset.segmentId = segment.id;
                
                if (timingMode) {
                    row.onclick = () => setSegmentTiming(segment.id);
                }
                
                row.innerHTML = `
                    <div class="segment-speaker">
                        <select class="speaker-select" onchange="updateSpeaker(${segment.id}, this.value)">
                            <option value="1" ${segment.speaker === 1 ? 'selected' : ''}>ğŸ‘¤ ì¸ê°„</option>
                            <option value="2" ${segment.speaker === 2 ? 'selected' : ''}>ğŸ¤– AI</option>
                        </select>
                    </div>
                    <div class="segment-text">${segment.text}</div>
                    <div class="segment-timing">
                        <input type="number" class="timing-input" 
                               value="${segment.startTime}" 
                               step="0.1" 
                               placeholder="ì‹œì‘ì‹œê°„"
                               onchange="updateSegmentTime(${segment.id}, 'start', this.value)">
                        <span>~</span>
                        <input type="number" class="timing-input" 
                               value="${segment.endTime}" 
                               step="0.1" 
                               placeholder="ì¢…ë£Œì‹œê°„"
                               onchange="updateSegmentTime(${segment.id}, 'end', this.value)">
                        <span>ì´ˆ</span>
                    </div>
                `;
                
                container.appendChild(row);
            });
        }
        
        function loadFiles() {
            const audioFile = document.getElementById('audioFile').files[0];
            const jsonFile = document.getElementById('jsonFile').files[0];
            
            if (!audioFile) {
                alert('ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            // ì˜¤ë””ì˜¤ ë¡œë“œ
            const audioURL = URL.createObjectURL(audioFile);
            audioPlayer.src = audioURL;
            
            // JSON íŒŒì¼ì´ ìˆë‹¤ë©´ ë¡œë“œ
            if (jsonFile) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        loadJSONData(data);
                    } catch (error) {
                        console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', error);
                        alert('JSON íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                };
                reader.readAsText(jsonFile);
            }
        }
        
        function loadJSONData(data) {
            currentSegments = [];
            let segmentIndex = 0;
            
            data.forEach(conv => {
                conv.segments.forEach(seg => {
                    currentSegments.push({
                        id: segmentIndex++,
                        speaker: conv.speaker,
                        text: seg.text,
                        startTime: seg.startTime || 0,
                        endTime: seg.endTime || 0
                    });
                });
            });
            
            renderSegments();
        }
        
        function toggleTimingMode() {
            if (!audioLoaded) {
                alert('ë¨¼ì € ì˜¤ë””ì˜¤ íŒŒì¼ì„ ë¡œë“œí•˜ì„¸ìš”.');
                return;
            }
            
            timingMode = !timingMode;
            const btn = document.getElementById('timingModeBtn');
            
            if (timingMode) {
                btn.textContent = 'ì‹¤ì‹œê°„ íƒ€ì´ë° ëª¨ë“œ ì¢…ë£Œ';
                btn.classList.add('active');
                alert('ì´ì œ ì˜¤ë””ì˜¤ë¥¼ ì¬ìƒí•˜ë©´ì„œ í…ìŠ¤íŠ¸ë¥¼ í´ë¦­í•˜ì—¬ íƒ€ì´ë°ì„ ì„¤ì •í•˜ì„¸ìš”!');
            } else {
                btn.textContent = 'ì‹¤ì‹œê°„ íƒ€ì´ë° ëª¨ë“œ ì‹œì‘';
                btn.classList.remove('active');
            }
            
            renderSegments();
        }
        
        function setSegmentTiming(segmentId) {
            if (!timingMode) return;
            
            const currentTime = audioPlayer.currentTime;
            const segment = currentSegments.find(s => s.id === segmentId);
            
            if (segment) {
                // ì‹œì‘ ì‹œê°„ì´ 0ì´ë©´ í˜„ì¬ ì‹œê°„ì„ ì‹œì‘ ì‹œê°„ìœ¼ë¡œ ì„¤ì •
                if (segment.startTime === 0) {
                    segment.startTime = parseFloat(currentTime.toFixed(1));
                } else {
                    // ì´ë¯¸ ì‹œì‘ ì‹œê°„ì´ ìˆìœ¼ë©´ ì¢…ë£Œ ì‹œê°„ìœ¼ë¡œ ì„¤ì •
                    segment.endTime = parseFloat(currentTime.toFixed(1));
                }
                
                // í™”ë©´ ì—…ë°ì´íŠ¸
                const row = document.querySelector(`[data-segment-id="${segmentId}"]`);
                if (row) {
                    row.classList.add('active');
                    setTimeout(() => row.classList.remove('active'), 1000);
                }
                
                renderSegments();
            }
        }
        
        function updateSpeaker(segmentId, speakerValue) {
            const segment = currentSegments.find(s => s.id === segmentId);
            if (segment) {
                segment.speaker = parseInt(speakerValue);
                console.log(`ì„¸ê·¸ë¨¼íŠ¸ ${segmentId} í™”ìë¥¼ ${speakerValue}ë²ˆìœ¼ë¡œ ë³€ê²½`);
            }
        }
        
        function updateSegmentTime(segmentId, type, value) {
            const segment = currentSegments.find(s => s.id === segmentId);
            if (segment) {
                if (type === 'start') {
                    segment.startTime = parseFloat(value) || 0;
                } else if (type === 'end') {
                    segment.endTime = parseFloat(value) || 0;
                }
            }
        }
        
        function updateCurrentTime() {
            const currentTime = audioPlayer.currentTime;
            const minutes = Math.floor(currentTime / 60);
            const seconds = Math.floor(currentTime % 60);
            document.getElementById('currentTime').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function playPause() {
            if (audioPlayer.paused) {
                audioPlayer.play();
            } else {
                audioPlayer.pause();
            }
        }
        
        function resetAudio() {
            audioPlayer.currentTime = 0;
        }
        
        function generateJSON() {
            // í™”ìë³„ë¡œ ê·¸ë£¹í™”
            const groupedBySpeaker = {};
            
            currentSegments.forEach(segment => {
                if (!groupedBySpeaker[segment.speaker]) {
                    groupedBySpeaker[segment.speaker] = [];
                }
                groupedBySpeaker[segment.speaker].push({
                    text: segment.text,
                    startTime: segment.startTime,
                    endTime: segment.endTime
                });
            });
            
            // ìµœì¢… í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            const result = Object.keys(groupedBySpeaker).map(speaker => ({
                speaker: parseInt(speaker),
                segments: groupedBySpeaker[speaker]
            }));
            
            const jsonOutput = document.getElementById('jsonOutput');
            jsonOutput.value = JSON.stringify(result, null, 2);
            
            return result;
        }
        
        function exportJSON() {
            const data = generateJSON();
            const jsonString = JSON.stringify(data, null, 2);
            
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'manual-timing-data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
        }
        
        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && audioLoaded) {
                e.preventDefault();
                playPause();
            }
            // í™”ì ì „í™˜ ë‹¨ì¶•í‚¤ (1, 2 í‚¤ë¡œ ì„ íƒëœ ì„¸ê·¸ë¨¼íŠ¸ì˜ í™”ì ë³€ê²½)
            if (e.key === '1' || e.key === '2') {
                const activeRow = document.querySelector('.segment-row.active');
                if (activeRow) {
                    const segmentId = parseInt(activeRow.dataset.segmentId);
                    updateSpeaker(segmentId, e.key);
                    renderSegments();
                }
            }
        });
        
        // ì´ˆê¸°í™”
        initializeApp();
    </script>
</body>
</html>