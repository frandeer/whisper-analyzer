<!DOCTYPE html>
<html lang="ko">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ÌåüÏ∫êÏä§Ìä∏ - Professional Subtitle Viewer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Color Palette - Professional Cinema */
            --primary-bg: #0a0a0a;
            --secondary-bg: #1a1a1a;
            --accent-bg: #2a2a2a;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            
            /* Text Colors */
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #707070;
            
            /* Speaker Colors */
            --speaker1-primary: #4a9eff;
            --speaker1-secondary: #2563eb;
            --speaker1-glow: rgba(74, 158, 255, 0.3);
            
            --speaker2-primary: #ff6b9d;
            --speaker2-secondary: #e91e63;
            --speaker2-glow: rgba(255, 107, 157, 0.3);
            
            /* Professional Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Typography Scale */
            --font-xs: 0.75rem;
            --font-sm: 0.875rem;
            --font-base: 1rem;
            --font-lg: 1.125rem;
            --font-xl: 1.25rem;
            --font-2xl: 1.5rem;
            --font-3xl: 1.875rem;
            --font-4xl: 2.25rem;
            
            /* Animation Timings */
            --timing-fast: 0.15s;
            --timing-normal: 0.3s;
            --timing-slow: 0.6s;
            --timing-cinematic: 1.2s;
            
            /* Professional Curves */
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --ease-cinematic: cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        /* Professional Background Pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(74, 158, 255, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 107, 157, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(74, 158, 255, 0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Main Container */
        .app-container {
            display: grid;
            grid-template-areas: 
                "main"
                "controls";
            grid-template-columns: 1fr;
            grid-template-rows: 1fr auto;
            height: 100vh;
            padding: var(--spacing-xl);
            gap: var(--spacing-lg);
        }

        /* Main Subtitle Area */
        .subtitle-stage {
            grid-area: main;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0;
        }

        .subtitle-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            height: 400px;
            perspective: 1000px;
        }

        .subtitle-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-2xl);
            transition: all var(--timing-cinematic) var(--ease-cinematic);
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: var(--spacing-xl);
            right: var(--spacing-xl);
            width: 300px;
            max-height: calc(100vh - 200px);
            overflow: visible;
            z-index: 100;
        }

        .settings-toggle {
            position: absolute;
            top: 0;
            right: 0;
            width: 48px;
            height: 48px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--timing-normal) var(--ease-smooth);
            backdrop-filter: blur(10px);
        }

        .settings-toggle:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.05);
        }

        .settings-toggle i {
            font-size: var(--font-lg);
            color: var(--text-secondary);
            transition: all var(--timing-normal) var(--ease-smooth);
        }

        .settings-content {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: var(--spacing-xl);
            margin-top: 60px;
            backdrop-filter: blur(20px);
            transform: translateX(100%);
            opacity: 0;
            transition: all var(--timing-slow) var(--ease-smooth);
            max-height: calc(100vh - 280px);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .settings-panel.expanded .settings-content {
            transform: translateX(0);
            opacity: 1;
        }

        .settings-panel.expanded .settings-toggle i {
            transform: rotate(180deg);
        }

        /* Settings Content Styles */
        .settings-section {
            margin-bottom: var(--spacing-xl);
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            font-size: var(--font-sm);
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .settings-header i {
            font-size: var(--font-xs);
            color: var(--speaker1-primary);
        }

        /* File Input Styles */
        .file-input-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .file-input-label {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--timing-normal) var(--ease-smooth);
            font-size: var(--font-sm);
        }

        .file-input-label:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: var(--speaker1-primary);
            transform: translateY(-1px);
        }

        .file-input-label i {
            color: var(--text-secondary);
            font-size: var(--font-xs);
            width: 16px;
            text-align: center;
        }

        .file-input-text {
            color: var(--text-secondary);
            flex: 1;
        }

        .file-input-label.has-file .file-input-text {
            color: var(--speaker1-primary);
        }

        .file-input-label.has-file i {
            color: var(--speaker1-primary);
        }

        /* Action Buttons */
        .action-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: 8px;
            font-size: var(--font-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--timing-normal) var(--ease-smooth);
            font-family: inherit;
        }

        .action-button:hover {
            transform: translateY(-1px);
        }

        .action-button.primary {
            background: linear-gradient(135deg, var(--speaker1-primary), var(--speaker1-secondary));
            color: white;
            box-shadow: 0 4px 12px var(--speaker1-glow);
        }

        .action-button.primary:hover {
            box-shadow: 0 6px 16px var(--speaker1-glow);
        }

        .action-button.secondary {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
        }

        .action-button.secondary:hover {
            background: rgba(255, 255, 255, 0.06);
            color: var(--text-primary);
        }

        /* Speaker Settings */
        .speaker-inputs {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .speaker-input-row {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .speaker-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .speaker-indicator.speaker1 {
            background: linear-gradient(135deg, var(--speaker1-primary), var(--speaker1-secondary));
            box-shadow: 0 2px 8px var(--speaker1-glow);
        }

        .speaker-indicator.speaker2 {
            background: linear-gradient(135deg, var(--speaker2-primary), var(--speaker2-secondary));
            box-shadow: 0 2px 8px var(--speaker2-glow);
        }

        .speaker-name-input {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: var(--font-sm);
            font-family: inherit;
            transition: all var(--timing-normal) var(--ease-smooth);
        }

        .speaker-name-input:focus {
            outline: none;
            border-color: var(--speaker1-primary);
            background: rgba(255, 255, 255, 0.06);
        }

        .speaker-name-input::placeholder {
            color: var(--text-muted);
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .quick-actions .action-button {
            flex: 1;
            font-size: var(--font-xs);
            padding: var(--spacing-sm);
        }

        /* Scrollbar Styling */
        .settings-content::-webkit-scrollbar {
            width: 4px;
        }

        .settings-content::-webkit-scrollbar-track {
            background: var(--glass-bg);
            border-radius: 2px;
        }

        .settings-content::-webkit-scrollbar-thumb {
            background: var(--glass-border);
            border-radius: 2px;
        }

        .settings-content::-webkit-scrollbar-thumb:hover {
            background: var(--speaker1-primary);
        }

        /* Smooth scrolling for settings */
        .settings-content {
            scroll-behavior: smooth;
        }

        /* Controls Panel */
        .controls-panel {
            grid-area: controls;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: var(--spacing-lg) var(--spacing-xl);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
            min-height: 80px;
        }

        /* Waveform Visualization */
        .waveform-container {
            position: relative;
            width: 200px;
            height: 40px;
            background: var(--secondary-bg);
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .waveform-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .progress-indicator {
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            height: 100%;
            background: var(--speaker1-primary);
            box-shadow: 0 0 8px var(--speaker1-glow);
            transition: left 0.1s ease;
        }

        #waveformCanvas {
            width: 100%;
            height: 100%;
            opacity: 0.7;
        }

        /* Main Controls */
        .main-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            flex-shrink: 0;
        }

        .control-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all var(--timing-normal) var(--ease-smooth);
            font-size: var(--font-lg);
            background: var(--glass-bg);
            color: var(--text-secondary);
            backdrop-filter: blur(10px);
        }

        .control-btn-primary {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--speaker1-primary), var(--speaker1-secondary));
            color: white;
            font-size: var(--font-xl);
            box-shadow: 0 4px 16px var(--speaker1-glow);
        }

        .control-btn-primary:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px var(--speaker1-glow);
        }

        .control-btn-secondary {
            width: 44px;
            height: 44px;
            border: 1px solid var(--glass-border);
        }

        .control-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            transform: scale(1.05);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        /* Time Controls */
        .time-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            flex: 1;
            min-width: 0;
        }

        .time-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: var(--font-sm);
            color: var(--text-primary);
            font-weight: 500;
            flex-shrink: 0;
            min-width: 45px;
            text-align: center;
        }

        .timeline-container {
            position: relative;
            flex: 1;
            height: 8px;
            background: var(--secondary-bg);
            border-radius: 4px;
            overflow: hidden;
        }

        .timeline-slider {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 2;
        }

        .timeline-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--speaker1-primary), var(--speaker2-primary));
            border-radius: 4px;
            width: 0%;
            transition: width 0.1s ease;
        }

        .timeline-progress::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity var(--timing-normal) var(--ease-smooth);
        }

        .timeline-container:hover .timeline-progress::after {
            opacity: 1;
        }

        /* Advanced Controls */
        .advanced-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            flex-shrink: 0;
        }

        .speed-control, .volume-control {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .speed-control i, .volume-control i {
            color: var(--text-secondary);
            font-size: var(--font-sm);
            width: 16px;
            text-align: center;
        }

        .speed-selector {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            padding: var(--spacing-xs) var(--spacing-sm);
            color: var(--text-primary);
            font-size: var(--font-sm);
            font-family: inherit;
            cursor: pointer;
            transition: all var(--timing-normal) var(--ease-smooth);
        }

        .speed-selector:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--speaker1-primary);
        }

        .speed-selector:focus {
            outline: none;
            border-color: var(--speaker1-primary);
            box-shadow: 0 0 0 2px var(--speaker1-glow);
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background: var(--secondary-bg);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: var(--speaker2-primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: var(--speaker2-primary);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* Professional Loading Animation for Waveform */
        .waveform-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            gap: 2px;
        }

        .waveform-loading-bar {
            width: 3px;
            height: 12px;
            background: var(--speaker1-primary);
            border-radius: 1px;
            animation: waveform-pulse 1.4s ease-in-out infinite both;
        }

        .waveform-loading-bar:nth-child(2) { animation-delay: -1.32s; }
        .waveform-loading-bar:nth-child(3) { animation-delay: -1.1s; }
        .waveform-loading-bar:nth-child(4) { animation-delay: -0.88s; }
        .waveform-loading-bar:nth-child(5) { animation-delay: -0.66s; }

        @keyframes waveform-pulse {
            0%, 40%, 100% {
                transform: scaleY(0.4);
                opacity: 0.5;
            }
            20% {
                transform: scaleY(1);
                opacity: 1;
            }
        }

        /* Control Panel Responsive Behavior */
        @media (max-width: 1024px) {
            .controls-panel {
                flex-wrap: wrap;
                gap: var(--spacing-md);
                padding: var(--spacing-md);
            }
            
            .waveform-container {
                order: 3;
                width: 100%;
                margin-top: var(--spacing-sm);
            }
            
            .time-controls {
                order: 2;
                flex-basis: 100%;
            }
        }

        @media (max-width: 768px) {
            .advanced-controls {
                gap: var(--spacing-md);
            }
            
            .volume-slider {
                width: 60px;
            }
            
            .waveform-container {
                height: 32px;
            }
        }

        /* Hidden Elements */
        .hidden {
            display: none !important;
        }

        /* Loading State */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity var(--timing-slow) var(--ease-smooth);
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 2px solid var(--glass-border);
            border-top: 2px solid var(--speaker1-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--spacing-lg);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: var(--font-lg);
            color: var(--text-secondary);
            font-weight: 300;
        }

        /* Status Messages */
        .status-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            opacity: 0.9;
            max-width: 400px;
            padding: var(--spacing-xl);
        }

        .status-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-xl);
            background: linear-gradient(135deg, var(--speaker1-primary), var(--speaker2-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gentle-pulse 2s ease-in-out infinite alternate;
        }

        .status-title {
            font-size: var(--font-2xl);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
            letter-spacing: 0.5px;
        }

        .status-subtitle {
            font-size: var(--font-lg);
            color: var(--text-secondary);
            font-weight: 300;
            line-height: 1.6;
            opacity: 0.8;
        }

        /* Gentle pulsing animation for status icon */
        @keyframes gentle-pulse {
            0% {
                opacity: 0.7;
                transform: scale(1);
            }
            100% {
                opacity: 1;
                transform: scale(1.05);
            }
        }

        /* Professional Speaker Bubble Styles */
        .speaker-bubble {
            position: relative;
            max-width: 85%;
            margin: 0 auto;
            opacity: 0;
            transform: translateY(30px) scale(0.95);
            transition: all var(--timing-cinematic) var(--ease-cinematic);
        }

        .speaker-bubble.active {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .speaker-bubble.fade-out {
            opacity: 0;
            transform: translateY(-20px) scale(0.98);
            transition: all 0.8s ease-out;
        }

        /* Speaker Label */
        .speaker-label {
            position: absolute;
            top: -12px;
            left: 24px;
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: var(--font-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 8px;
            z-index: 10;
            transition: all var(--timing-normal) var(--ease-smooth);
        }

        /* Speaker 1 (Human) Styles */
        .speaker-bubble.speaker1 .speaker-label {
            background: linear-gradient(135deg, var(--speaker1-primary), var(--speaker1-secondary));
            color: white;
            box-shadow: 0 4px 20px var(--speaker1-glow);
        }

        .speaker-bubble.speaker1 .message-content {
            background: linear-gradient(135deg, var(--speaker1-primary), var(--speaker1-secondary));
            border-bottom-left-radius: 8px;
        }

        /* Speaker 2 (AI) Styles */
        .speaker-bubble.speaker2 .speaker-label {
            background: linear-gradient(135deg, var(--speaker2-primary), var(--speaker2-secondary));
            color: white;
            box-shadow: 0 4px 20px var(--speaker2-glow);
        }

        .speaker-bubble.speaker2 .message-content {
            background: linear-gradient(135deg, var(--speaker2-primary), var(--speaker2-secondary));
            border-bottom-right-radius: 8px;
        }

        .speaker-bubble.speaker2 {
            margin-left: auto;
        }

        .speaker-bubble.speaker2 .speaker-label {
            right: 24px;
            left: auto;
        }

        /* Message Content */
        .message-content {
            position: relative;
            padding: var(--spacing-xl) var(--spacing-2xl);
            border-radius: 24px;
            color: white;
            font-size: var(--font-xl);
            font-weight: 400;
            line-height: 1.6;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                0 4px 16px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .message-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            border-radius: inherit;
            opacity: 0.1;
            pointer-events: none;
        }

        /* Professional Typing Animation */
        .typing-text {
            position: relative;
            display: inline-block;
        }

        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1.4em;
            background: currentColor;
            margin-left: 3px;
            vertical-align: text-bottom;
            animation: professional-blink 1.2s ease-in-out infinite;
            border-radius: 1px;
        }

        @keyframes professional-blink {
            0%, 50% { 
                opacity: 1; 
                transform: scaleY(1);
            }
            51%, 100% { 
                opacity: 0; 
                transform: scaleY(0.8);
            }
        }

        /* Character Animation - Simple Pop Effect */
        .char-animate {
            display: inline-block;
            opacity: 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        /* Glow Effects */
        .speaker-bubble.active .message-content {
            animation: subtle-glow 3s ease-in-out infinite alternate;
        }

        @keyframes subtle-glow {
            0% {
                box-shadow: 
                    0 8px 32px rgba(0, 0, 0, 0.3),
                    0 4px 16px rgba(0, 0, 0, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
            }
            100% {
                box-shadow: 
                    0 12px 40px rgba(0, 0, 0, 0.4),
                    0 6px 20px rgba(0, 0, 0, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
            }
        }

        .speaker-bubble.speaker1.active .message-content {
            animation: speaker1-glow 3s ease-in-out infinite alternate;
        }

        .speaker-bubble.speaker2.active .message-content {
            animation: speaker2-glow 3s ease-in-out infinite alternate;
        }

        @keyframes speaker1-glow {
            0% {
                box-shadow: 
                    0 8px 32px rgba(0, 0, 0, 0.3),
                    0 4px 16px var(--speaker1-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
            }
            100% {
                box-shadow: 
                    0 12px 40px rgba(0, 0, 0, 0.4),
                    0 8px 24px var(--speaker1-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
        }

        @keyframes speaker2-glow {
            0% {
                box-shadow: 
                    0 8px 32px rgba(0, 0, 0, 0.3),
                    0 4px 16px var(--speaker2-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
            }
            100% {
                box-shadow: 
                    0 12px 40px rgba(0, 0, 0, 0.4),
                    0 8px 24px var(--speaker2-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
        }

        /* Slide Transitions */
        .subtitle-slide.slide-in {
            animation: slide-in var(--timing-cinematic) var(--ease-cinematic) forwards;
        }

        .subtitle-slide.slide-out {
            animation: slide-out var(--timing-cinematic) var(--ease-cinematic) forwards;
        }

        @keyframes slide-in {
            0% {
                opacity: 0;
                transform: translateY(100%) scale(0.9);
            }
            60% {
                opacity: 0.8;
                transform: translateY(-10%) scale(1.02);
            }
            100% {
                opacity: 1;
                transform: translateY(0%) scale(1);
            }
        }

        @keyframes slide-out {
            0% {
                opacity: 1;
                transform: translateY(0%) scale(1);
            }
            40% {
                opacity: 0.6;
                transform: translateY(-10%) scale(0.98);
            }
            100% {
                opacity: 0;
                transform: translateY(-100%) scale(0.9);
            }
        }

        /* Progress Indicator */
        .progress-glow {
            position: absolute;
            bottom: -4px;
            left: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                currentColor 50%, 
                transparent 100%);
            border-radius: 1px;
            opacity: 0.6;
            animation: progress-flow 2s ease-in-out infinite;
        }

        @keyframes progress-flow {
            0%, 100% {
                transform: translateX(-100%);
                opacity: 0;
            }
            50% {
                transform: translateX(0%);
                opacity: 0.8;
            }
        }

        /* Micro-interactions */
        .speaker-bubble:hover .message-content {
            transform: translateY(-2px);
            transition: transform var(--timing-fast) var(--ease-smooth);
        }

        .speaker-label:hover {
            transform: scale(1.05);
        }

        /* Focus and Accessibility */
        .message-content:focus {
            outline: 2px solid var(--speaker1-primary);
            outline-offset: 4px;
        }

        /* Responsive Typography */
        @media (max-width: 768px) {
            .message-content {
                font-size: var(--font-lg);
                padding: var(--spacing-lg) var(--spacing-xl);
            }
            
            .speaker-bubble {
                max-width: 95%;
            }
        }

        @media (max-width: 480px) {
            .message-content {
                font-size: var(--font-base);
                padding: var(--spacing-md) var(--spacing-lg);
            }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .app-container {
                padding: var(--spacing-lg);
            }
            
            .settings-panel {
                top: var(--spacing-lg);
                right: var(--spacing-lg);
                width: 280px;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: var(--spacing-md);
            }
            
            .settings-panel {
                width: 250px;
                top: var(--spacing-md);
                right: var(--spacing-md);
            }
            
            .subtitle-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">AI ÌåüÏ∫êÏä§Ìä∏ Ï¥àÍ∏∞Ìôî Ï§ë...</div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="app-container">
        <!-- Main Subtitle Stage -->
        <div class="subtitle-stage">
            <div class="subtitle-container" id="subtitleContainer">
                <!-- Current Slide -->
                <div class="subtitle-slide" id="currentSlide">
                    <!-- Current speaker content will be inserted here -->
                </div>
                
                <!-- Previous Slide -->
                <div class="subtitle-slide" id="previousSlide" style="transform: translateY(-100%);">
                    <!-- Previous speaker content will be inserted here -->
                </div>
                
                <!-- Status Message (shown when no content) -->
                <div class="status-message" id="statusMessage">
                    <div class="status-icon">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <div class="status-title">Ïû¨ÏÉù Ï§ÄÎπÑ Ï§ë</div>
                    <div class="status-subtitle">Ïò§ÎîîÏò§ ÏΩòÌÖêÏ∏†Î•º Î°úÎìúÌïòÍ±∞ÎÇò Ïû¨ÏÉù Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî</div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-toggle" id="settingsToggle">
                <i class="fas fa-cog"></i>
            </div>
            
            <div class="settings-content" id="settingsContent">
                <!-- File Upload Section -->
                <div class="settings-section">
                    <div class="settings-header">
                        <i class="fas fa-file-audio"></i>
                        <span>ÏΩòÌÖêÏ∏†</span>
                    </div>
                    
                    <div class="file-input-group">
                        <label class="file-input-label">
                            <i class="fas fa-music"></i>
                            <input type="file" id="audioFile" accept="audio/*" hidden>
                            <span class="file-input-text" data-default="Ïò§ÎîîÏò§ ÌååÏùº">Ïò§ÎîîÏò§ ÌååÏùº</span>
                        </label>
                        
                        <label class="file-input-label">
                            <i class="fas fa-file-code"></i>
                            <input type="file" id="jsonFile" accept=".json" hidden>
                            <span class="file-input-text" data-default="JSON ÌååÏùº">JSON ÌååÏùº</span>
                        </label>
                    </div>
                    
                    <button class="action-button primary" id="loadFilesBtn">
                        <i class="fas fa-play"></i>
                        <span>Î°úÎìú</span>
                    </button>
                </div>

                <!-- Speaker Settings -->
                <div class="settings-section">
                    <div class="settings-header">
                        <i class="fas fa-users"></i>
                        <span>ÌôîÏûê</span>
                    </div>
                    
                    <div class="speaker-inputs" id="speakerInputs">
                        <div class="speaker-input-row">
                            <div class="speaker-indicator speaker1"></div>
                            <input type="text" class="speaker-name-input" id="speaker1Name" value="Ïù∏Í∞Ñ" placeholder="ÌôîÏûê 1">
                        </div>
                        <div class="speaker-input-row">
                            <div class="speaker-indicator speaker2"></div>
                            <input type="text" class="speaker-name-input" id="speaker2Name" value="AI" placeholder="ÌôîÏûê 2">
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="settings-section">
                    <div class="settings-header">
                        <i class="fas fa-bolt"></i>
                        <span>Îπ†Î•∏ Ïã§Ìñâ</span>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="action-button secondary" id="loadDefaultBtn">
                            <i class="fas fa-magic"></i>
                            <span>Í∏∞Î≥∏ ÏΩòÌÖêÏ∏†</span>
                        </button>
                        
                        <button class="action-button secondary" id="resetBtn">
                            <i class="fas fa-redo"></i>
                            <span>Ï¥àÍ∏∞Ìôî</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls Panel -->
        <div class="controls-panel" id="controlsPanel">
            <!-- Waveform Visualization -->
            <div class="waveform-container">
                <canvas id="waveformCanvas" width="200" height="40"></canvas>
                <div class="waveform-overlay">
                    <div class="progress-indicator" id="progressIndicator"></div>
                </div>
            </div>
            
            <!-- Main Controls -->
            <div class="main-controls">
                <button class="control-btn control-btn-secondary" id="skipBackBtn" title="10Ï¥à Îí§Î°ú">
                    <i class="fas fa-backward"></i>
                </button>
                
                <button class="control-btn control-btn-primary" id="playPauseBtn" title="Ïû¨ÏÉù/ÏùºÏãúÏ†ïÏßÄ">
                    <i class="fas fa-play" id="playPauseIcon"></i>
                </button>
                
                <button class="control-btn control-btn-secondary" id="skipForwardBtn" title="10Ï¥à ÏïûÏúºÎ°ú">
                    <i class="fas fa-forward"></i>
                </button>
            </div>
            
            <!-- Time Display -->
            <div class="time-controls">
                <span class="time-display" id="currentTime">00:00</span>
                <div class="timeline-container">
                    <input type="range" class="timeline-slider" id="timelineSlider" 
                           min="0" max="100" value="0" step="0.1">
                    <div class="timeline-progress" id="timelineProgress"></div>
                </div>
                <span class="time-display" id="totalTime">00:00</span>
            </div>
            
            <!-- Speed and Volume Controls -->
            <div class="advanced-controls" id="advancedControls">
                <div class="speed-control">
                    <i class="fas fa-tachometer-alt"></i>
                    <select class="speed-selector" id="speedSelector">
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="1" selected>1x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2x</option>
                    </select>
                </div>
                
                <div class="volume-control">
                    <i class="fas fa-volume-up" id="volumeIcon"></i>
                    <input type="range" class="volume-slider" id="volumeSlider" 
                           min="0" max="1" value="1" step="0.05">
                </div>
            </div>
        </div>
    </div>


    
    <script>
        // Global variables for professional subtitle viewer
        let audioPlayer;
        let conversationData = [];
        let currentTypingTimeout = null;
        let filesLoaded = false;
        let speakerNames = {
            1: 'Ïù∏Í∞Ñ',
            2: 'AI'
        };
        let currentActiveSlide = null;
        let previousActiveSlide = null;
        let globalAnimationId = null;

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            // Simulate loading
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').classList.add('hidden');
                }, 600);
            }, 1500);

            // Initialize core components
            initializeApp();
            setupEventListeners();
            
            // Auto-load default files
            setTimeout(() => {
                loadDefaultFiles();
            }, 2000);

            console.log('üé¨ Professional AI Podcast Viewer initialized');
        });

        function initializeApp() {
            audioPlayer = document.createElement('audio');
            audioPlayer.addEventListener('timeupdate', updateCinematicSubtitles);
            audioPlayer.addEventListener('loadedmetadata', updateTimeDisplay);
            audioPlayer.addEventListener('ended', handleAudioEnd);
            document.body.appendChild(audioPlayer);
        }

        function setupEventListeners() {
            // Settings panel toggle
            const settingsToggle = document.getElementById('settingsToggle');
            const settingsPanel = document.getElementById('settingsPanel');
            
            settingsToggle.addEventListener('click', function() {
                settingsPanel.classList.toggle('expanded');
            });

            // File input handlers
            const audioFileInput = document.getElementById('audioFile');
            const jsonFileInput = document.getElementById('jsonFile');
            const loadFilesBtn = document.getElementById('loadFilesBtn');
            const loadDefaultBtn = document.getElementById('loadDefaultBtn');
            const resetBtn = document.getElementById('resetBtn');

            audioFileInput.addEventListener('change', handleFileSelect);
            jsonFileInput.addEventListener('change', handleFileSelect);
            loadFilesBtn.addEventListener('click', loadCustomFiles);
            loadDefaultBtn.addEventListener('click', loadDefaultFiles);
            resetBtn.addEventListener('click', resetApplication);

            // Speaker name inputs
            const speaker1Input = document.getElementById('speaker1Name');
            const speaker2Input = document.getElementById('speaker2Name');
            
            speaker1Input.addEventListener('input', (e) => {
                speakerNames[1] = e.target.value;
                updateActiveSpeakerLabels();
            });
            
            speaker2Input.addEventListener('input', (e) => {
                speakerNames[2] = e.target.value;
                updateActiveSpeakerLabels();
            });

            // Audio control event listeners
            setupAudioControls();
            
            // Show initial empty status
            showEmptyStatus();
        }

        function setupAudioControls() {
            const playPauseBtn = document.getElementById('playPauseBtn');
            const playPauseIcon = document.getElementById('playPauseIcon');
            const skipBackBtn = document.getElementById('skipBackBtn');
            const skipForwardBtn = document.getElementById('skipForwardBtn');
            const timelineSlider = document.getElementById('timelineSlider');
            const speedSelector = document.getElementById('speedSelector');
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeIcon = document.getElementById('volumeIcon');

            // Play/Pause functionality
            playPauseBtn.addEventListener('click', () => {
                if (!filesLoaded) {
                    showStatusMessage(
                        'ÏΩòÌÖêÏ∏† ÏóÜÏùå', 
                        'fas fa-exclamation-triangle',
                        'Î®ºÏ†Ä Ïò§ÎîîÏò§ ÌååÏùºÏùÑ Î°úÎìúÌï¥Ï£ºÏÑ∏Ïöî'
                    );
                    return;
                }

                if (audioPlayer.paused) {
                    audioPlayer.play();
                    playPauseIcon.className = 'fas fa-pause';
                } else {
                    audioPlayer.pause();
                    playPauseIcon.className = 'fas fa-play';
                }
            });

            // Skip controls
            skipBackBtn.addEventListener('click', () => {
                if (filesLoaded) {
                    audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 10);
                }
            });

            skipForwardBtn.addEventListener('click', () => {
                if (filesLoaded) {
                    audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 10);
                }
            });

            // Timeline scrubbing
            timelineSlider.addEventListener('input', (e) => {
                if (filesLoaded && audioPlayer.duration) {
                    const newTime = (e.target.value / 100) * audioPlayer.duration;
                    audioPlayer.currentTime = newTime;
                }
            });

            // Playback speed
            speedSelector.addEventListener('change', (e) => {
                if (filesLoaded) {
                    audioPlayer.playbackRate = parseFloat(e.target.value);
                }
            });

            // Volume control
            volumeSlider.addEventListener('input', (e) => {
                const volume = parseFloat(e.target.value);
                audioPlayer.volume = volume;
                updateVolumeIcon(volume);
            });

            // Audio event listeners
            audioPlayer.addEventListener('play', () => {
                playPauseIcon.className = 'fas fa-pause';
                hideStatusMessage(); // Ïû¨ÏÉù ÏãúÏûëÌïòÎ©¥ ÏÉÅÌÉú Î©îÏãúÏßÄ Ïà®ÍπÄ
            });

            audioPlayer.addEventListener('pause', () => {
                playPauseIcon.className = 'fas fa-play';
            });

            audioPlayer.addEventListener('loadedmetadata', () => {
                initializeWaveform();
                updateTimeDisplay();
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (!filesLoaded) return;

                switch(e.code) {
                    case 'Space':
                        e.preventDefault();
                        playPauseBtn.click();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        skipBackBtn.click();
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        skipForwardBtn.click();
                        break;
                }
            });
        }

        function updateVolumeIcon(volume) {
            const volumeIcon = document.getElementById('volumeIcon');
            
            if (volume === 0) {
                volumeIcon.className = 'fas fa-volume-mute';
            } else if (volume < 0.5) {
                volumeIcon.className = 'fas fa-volume-down';
            } else {
                volumeIcon.className = 'fas fa-volume-up';
            }
        }

        function initializeWaveform() {
            const canvas = document.getElementById('waveformCanvas');
            const ctx = canvas.getContext('2d');
            
            // Show loading animation first
            showWaveformLoading();
            
            // Simple waveform visualization - in a real app, you'd analyze the audio
            setTimeout(() => {
                drawStaticWaveform(ctx, canvas);
            }, 1000);
        }

        function showWaveformLoading() {
            const canvas = document.getElementById('waveformCanvas');
            const container = canvas.parentElement;
            
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'waveform-loading';
            loadingDiv.innerHTML = `
                <div class="waveform-loading-bar"></div>
                <div class="waveform-loading-bar"></div>
                <div class="waveform-loading-bar"></div>
                <div class="waveform-loading-bar"></div>
                <div class="waveform-loading-bar"></div>
            `;
            
            canvas.style.display = 'none';
            container.appendChild(loadingDiv);
            
            setTimeout(() => {
                container.removeChild(loadingDiv);
                canvas.style.display = 'block';
            }, 1000);
        }

        function drawStaticWaveform(ctx, canvas) {
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            // Create gradient
            const gradient = ctx.createLinearGradient(0, 0, width, 0);
            gradient.addColorStop(0, getComputedStyle(document.documentElement).getPropertyValue('--speaker1-primary'));
            gradient.addColorStop(1, getComputedStyle(document.documentElement).getPropertyValue('--speaker2-primary'));
            
            ctx.fillStyle = gradient;
            
            // Draw pseudo-waveform
            const barCount = 50;
            const barWidth = width / barCount;
            
            for (let i = 0; i < barCount; i++) {
                const x = i * barWidth;
                const normalizedHeight = Math.random() * 0.8 + 0.2; // Random between 0.2 and 1
                const barHeight = height * normalizedHeight;
                const y = (height - barHeight) / 2;
                
                ctx.fillRect(x, y, barWidth - 1, barHeight);
            }
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const label = event.target.closest('.file-input-label');
            const textSpan = label.querySelector('.file-input-text');
            
            textSpan.textContent = file.name;
            label.classList.add('has-file');
        }

        async function loadCustomFiles() {
            const audioFile = document.getElementById('audioFile').files[0];
            const jsonFile = document.getElementById('jsonFile').files[0];
            
            if (!audioFile || !jsonFile) {
                showStatusMessage(
                    'ÌååÏùº ÏÑ†ÌÉù ÌïÑÏöî', 
                    'fas fa-exclamation-triangle',
                    'Ïò§ÎîîÏò§ ÌååÏùºÍ≥º JSON ÌååÏùºÏùÑ Î™®Îëê ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî'
                );
                return;
            }

            try {
                showLoadingStatus();
                
                // Load JSON data
                const jsonText = await jsonFile.text();
                conversationData = JSON.parse(jsonText);
                
                // Prepare conversation data for cinematic display
                prepareConversationData();
                
                // Load audio
                const audioURL = URL.createObjectURL(audioFile);
                audioPlayer.src = audioURL;
                
                filesLoaded = true;
                showReadyStatus();
                
                console.log('üé¨ Custom files loaded successfully');
                
            } catch (error) {
                console.error('File loading error:', error);
                showStatusMessage(
                    'Î°úÎìú Ïã§Ìå®', 
                    'fas fa-times',
                    'ÌååÏùºÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§'
                );
            }
        }

        async function loadDefaultFiles() {
            try {
                showLoadingStatus();
                
                // Load default JSON
                const jsonResponse = await fetch('whisper-analysis.json');
                if (jsonResponse.ok) {
                    conversationData = await jsonResponse.json();
                } else {
                    throw new Error('Default JSON not found');
                }
                
                // Load default audio
                const audioResponse = await fetch('audio.wav');
                if (audioResponse.ok) {
                    const audioBlob = await audioResponse.blob();
                    const audioURL = URL.createObjectURL(audioBlob);
                    audioPlayer.src = audioURL;
                } else {
                    throw new Error('Default audio not found');
                }
                
                // Prepare data
                prepareConversationData();
                filesLoaded = true;
                showReadyStatus();
                
                console.log('üé¨ Default files loaded successfully');
                
            } catch (error) {
                console.log('Default files not available, manual upload required');
                showEmptyStatus();
            }
        }

        function prepareConversationData() {
            // Sort all segments by time and group by speaker changes
            const allSegments = [];
            
            conversationData.forEach((conversation) => {
                conversation.segments.forEach(segment => {
                    allSegments.push({
                        ...segment,
                        speaker: conversation.speaker
                    });
                });
            });
            
            // Sort by start time
            allSegments.sort((a, b) => a.startTime - b.startTime);
            
            // Group consecutive segments by same speaker
            const groupedSegments = [];
            let currentGroup = null;
            
            allSegments.forEach(segment => {
                if (!currentGroup || currentGroup.speaker !== segment.speaker || 
                    (segment.startTime - currentGroup.endTime > 2)) {
                    
                    if (currentGroup) {
                        groupedSegments.push(currentGroup);
                    }
                    
                    currentGroup = {
                        speaker: segment.speaker,
                        segments: [segment],
                        startTime: segment.startTime,
                        endTime: segment.endTime,
                        fullText: segment.text
                    };
                } else {
                    currentGroup.segments.push(segment);
                    currentGroup.endTime = segment.endTime;
                    currentGroup.fullText += ' ' + segment.text;
                }
            });
            
            if (currentGroup) {
                groupedSegments.push(currentGroup);
            }
            
            // Store prepared data globally
            window.cinematicGroups = groupedSegments;
            window.currentGroupIndex = -1;
            
            console.log('üé≠ Conversation data prepared for cinematic display:', groupedSegments.length, 'groups');
            
            // Debug: ÌôîÏûêÎ≥Ñ Í∑∏Î£π ÌôïÏù∏
            groupedSegments.forEach((group, index) => {
                console.log(`Group ${index}: Speaker ${group.speaker}, ${group.startTime}s-${group.endTime}s, "${group.fullText.substring(0, 50)}..."`);
            });
        }

        function updateCinematicSubtitles() {
            if (!filesLoaded || !window.cinematicGroups) return;
            
            const currentTime = audioPlayer.currentTime;
            
            // Update time display and progress
            updateTimeDisplay();
            
            // Find active group with improved gap handling
            let activeGroupIndex = -1;
            let nextGroupIndex = -1;
            let nextGroupStartTime = Infinity;
            
            for (let i = 0; i < window.cinematicGroups.length; i++) {
                const group = window.cinematicGroups[i];
                
                // Check if currently in this group (with 0.1s buffer)
                if (currentTime >= (group.startTime - 0.1) && currentTime <= (group.endTime + 0.1)) {
                    activeGroupIndex = i;
                    break;
                }
                
                // Find next upcoming group
                if (group.startTime > currentTime && group.startTime < nextGroupStartTime) {
                    nextGroupIndex = i;
                    nextGroupStartTime = group.startTime;
                }
            }
            
            // Gap handling: if no active group but next group starts within 3 seconds, maintain current
            let shouldKeepCurrent = false;
            if (activeGroupIndex === -1 && nextGroupIndex !== -1) {
                const timeToNext = nextGroupStartTime - currentTime;
                if (timeToNext <= 3.0 && window.currentGroupIndex !== -1) {
                    console.log(`‚è≥ Gap detected: ${timeToNext.toFixed(1)}s until next group. Maintaining current.`);
                    shouldKeepCurrent = true;
                    activeGroupIndex = window.currentGroupIndex; // Keep current group
                }
            }
            
            // Enhanced debug logging
            if (activeGroupIndex !== window.currentGroupIndex && !shouldKeepCurrent) {
                console.log(`üé¨ Time: ${currentTime.toFixed(1)}s, Active Group: ${activeGroupIndex}`);
                if (activeGroupIndex !== -1) {
                    const group = window.cinematicGroups[activeGroupIndex];
                    console.log(`   ‚ñ∂Ô∏è Speaker ${group.speaker}: ${group.startTime}s-${group.endTime}s "${group.fullText.substring(0, 50)}..."`);
                } else {
                    console.log(`   ‚è∏Ô∏è No active group, next starts at ${nextGroupStartTime.toFixed(1)}s`);
                }
            }
            
            // Handle group change (only if actually changing and not maintaining)
            if (activeGroupIndex !== window.currentGroupIndex && !shouldKeepCurrent) {
                if (activeGroupIndex !== -1) {
                    // Double-check: only transition if we haven't already shown this group
                    if (!currentActiveSlide || !currentActiveSlide.classList.contains(`speaker${window.cinematicGroups[activeGroupIndex].speaker}`)) {
                        console.log(`üîÑ Transitioning to group ${activeGroupIndex}`);
                        transitionToGroup(activeGroupIndex, currentTime);
                    }
                } else {
                    // Only clear if next group is far away
                    if (nextGroupStartTime - currentTime > 3.0) {
                        console.log(`üßπ Clearing display (next group ${nextGroupStartTime - currentTime}s away)`);
                        clearSubtitleDisplay();
                    }
                }
                window.currentGroupIndex = activeGroupIndex;
            }
            
            // Update typing animation for current group
            if (activeGroupIndex !== -1) {
                updateGroupTypingAnimation(activeGroupIndex, currentTime);
            }
        }

        function transitionToGroup(groupIndex, currentTime) {
            const group = window.cinematicGroups[groupIndex];
            const subtitleContainer = document.getElementById('subtitleContainer');
            
            console.log(`üé¨ Starting transition to group ${groupIndex} (Speaker ${group.speaker})`);
            
            // Prevent duplicate transitions
            if (currentActiveSlide && currentActiveSlide.dataset.groupIndex == groupIndex) {
                console.log(`   ‚ö†Ô∏è Already showing group ${groupIndex}, skipping transition`);
                return;
            }
            
            // Clear previous content
            const currentSlide = document.getElementById('currentSlide');
            const previousSlide = document.getElementById('previousSlide');
            
            // Move current to previous (if exists)
            if (currentActiveSlide) {
                console.log(`   üì§ Moving previous slide content`);
                previousSlide.innerHTML = currentActiveSlide.innerHTML;
                const prevBubble = previousSlide.querySelector('.speaker-bubble');
                if (prevBubble) {
                    prevBubble.classList.add('fade-out');
                    prevBubble.classList.remove('active');
                }
            }
            
            // Create new subtitle bubble
            console.log(`   üé≠ Creating new bubble for Speaker ${group.speaker}`);
            const speakerBubble = createCinematicSpeakerBubble(group);
            speakerBubble.dataset.groupIndex = groupIndex; // Track which group this is
            
            currentSlide.innerHTML = '';
            currentSlide.appendChild(speakerBubble);
            
            // Force immediate display with all necessary CSS properties
            speakerBubble.style.opacity = '1';
            speakerBubble.style.visibility = 'visible';
            speakerBubble.style.display = 'block';
            speakerBubble.style.transform = 'translateY(0) scale(1)';
            
            // Add active class immediately
            speakerBubble.classList.add('active');
            
            // Ensure the bubble is properly styled for its speaker
            if (group.speaker === 2) {
                console.log(`   üé® Applying Speaker 2 styles`);
                speakerBubble.style.marginLeft = 'auto';
            }
            
            currentActiveSlide = speakerBubble;
            
            console.log(`   ‚úÖ Transition completed for Speaker ${group.speaker}`);
            console.log(`   üéØ Current slide has ${currentSlide.children.length} children`);
            console.log(`   üîç Bubble classes: ${speakerBubble.className}`);
        }

        function createCinematicSpeakerBubble(group) {
            console.log(`üé≠ Creating bubble for Speaker ${group.speaker}: "${group.fullText.substring(0, 30)}..."`);
            
            const bubble = document.createElement('div');
            bubble.className = `speaker-bubble speaker${group.speaker}`;
            
            // Debug: ÌÅ¥ÎûòÏä§ Ï†ÅÏö© ÌôïÏù∏
            console.log(`   üìù Bubble classes: ${bubble.className}`);
            
            // Speaker label
            const label = document.createElement('div');
            label.className = 'speaker-label';
            label.textContent = speakerNames[group.speaker] || `Speaker ${group.speaker}`;
            bubble.appendChild(label);
            
            // Message content container
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            // Typing text element
            const typingText = document.createElement('span');
            typingText.className = 'typing-text';
            typingText.textContent = '';
            typingText.dataset.fullText = group.fullText;
            typingText.dataset.segments = JSON.stringify(group.segments);
            
            messageContent.appendChild(typingText);
            bubble.appendChild(messageContent);
            
            // Debug: ÏôÑÏÑ±Îêú bubble Íµ¨Ï°∞ ÌôïÏù∏
            console.log(`   ‚úÖ Bubble created with ${bubble.children.length} children`);
            
            return bubble;
        }

        function updateGroupTypingAnimation(groupIndex, currentTime) {
            const group = window.cinematicGroups[groupIndex];
            const typingElement = document.querySelector('#currentSlide .typing-text');
            
            if (!typingElement) return;
            
            // Find current segment
            const currentSegment = group.segments.find(seg => 
                currentTime >= seg.startTime && currentTime <= seg.endTime
            );
            
            if (currentSegment) {
                // Calculate typing progress within current segment
                const segmentProgress = (currentTime - currentSegment.startTime) / 
                                     (currentSegment.endTime - currentSegment.startTime);
                
                // Calculate overall progress considering all previous completed segments
                let completedText = '';
                let currentSegmentIndex = group.segments.indexOf(currentSegment);
                
                // Add all completed segments
                for (let i = 0; i < currentSegmentIndex; i++) {
                    completedText += group.segments[i].text + ' ';
                }
                
                // Add partial current segment
                const currentSegmentText = currentSegment.text;
                const typedLength = Math.floor(currentSegmentText.length * Math.min(1, segmentProgress));
                const typedCurrentText = currentSegmentText.substring(0, typedLength);
                
                // Create cinematic typing effect
                const displayText = completedText + typedCurrentText;
                
                // Apply character-by-character animation
                applyCinematicTyping(typingElement, displayText, typedLength < currentSegmentText.length);
            }
        }

        function applyCinematicTyping(element, text, showCursor) {
            // Clear any existing animation
            if (globalAnimationId) {
                cancelAnimationFrame(globalAnimationId);
            }
            
            // Get current content to avoid re-animating existing characters
            const currentText = element.textContent || '';
            
            // Only animate new characters that were added
            if (text.length <= currentText.length) {
                // Text is getting shorter or same, just update
                element.textContent = text;
                if (showCursor) {
                    element.innerHTML = text + '<span class="typing-cursor"></span>';
                }
                return;
            }
            
            // Text is getting longer - animate new characters only
            const newCharsStartIndex = currentText.length;
            const newChars = text.slice(newCharsStartIndex);
            
            // Build HTML with existing text + new animated characters
            let htmlContent = currentText; // Existing text without animation
            
            Array.from(newChars).forEach((char, index) => {
                if (char === ' ') {
                    htmlContent += ' ';
                } else {
                    const delay = index * 80; // Faster for smoother flow
                    htmlContent += `<span class="char-animate">${char}</span>`;
                }
            });
            
            // Add blinking cursor if still typing
            if (showCursor) {
                htmlContent += '<span class="typing-cursor"></span>';
            }
            
            element.innerHTML = htmlContent;
            
            // No animation needed - just display the characters
        }

        function clearSubtitleDisplay(force = false) {
            console.log(`üßπ Clearing subtitle display (force: ${force})`);
            
            const currentSlide = document.getElementById('currentSlide');
            const previousSlide = document.getElementById('previousSlide');
            
            if (currentActiveSlide) {
                console.log(`   üö´ Fading out current active slide`);
                currentActiveSlide.classList.add('fade-out');
                currentActiveSlide.classList.remove('active');
                
                if (force) {
                    // Immediate clear for forced clearing
                    currentSlide.innerHTML = '';
                    previousSlide.innerHTML = '';
                    currentActiveSlide = null;
                    console.log(`   ‚úÖ Slides cleared immediately`);
                } else {
                    // Delayed clear for normal clearing
                    setTimeout(() => {
                        currentSlide.innerHTML = '';
                        previousSlide.innerHTML = '';
                        currentActiveSlide = null;
                        console.log(`   ‚úÖ Slides cleared after delay`);
                    }, 600);
                }
            } else {
                // Ï¶âÏãú ÌÅ¥Î¶¨Ïñ¥
                currentSlide.innerHTML = '';
                previousSlide.innerHTML = '';
                currentActiveSlide = null;
            }
        }

        function updateActiveSpeakerLabels() {
            const activeLabels = document.querySelectorAll('.speaker-label');
            activeLabels.forEach(label => {
                const bubble = label.closest('.speaker-bubble');
                if (bubble.classList.contains('speaker1')) {
                    label.textContent = speakerNames[1];
                } else if (bubble.classList.contains('speaker2')) {
                    label.textContent = speakerNames[2];
                }
            });
        }

        function showStatusMessage(message, iconClass, subtitle = null) {
            const statusMessage = document.getElementById('statusMessage');
            const statusIcon = statusMessage.querySelector('.status-icon i');
            const statusTitle = statusMessage.querySelector('.status-title');
            const statusSubtitle = statusMessage.querySelector('.status-subtitle');
            
            statusIcon.className = iconClass;
            statusTitle.textContent = message;
            
            if (subtitle) {
                statusSubtitle.textContent = subtitle;
            }
            
            statusMessage.style.display = 'block';
        }

        function showReadyStatus() {
            showStatusMessage(
                'Ïû¨ÏÉù Ï§ÄÎπÑ ÏôÑÎ£å', 
                'fas fa-play-circle',
                'ÏïÑÎûò Ïû¨ÏÉù Î≤ÑÌäºÏùÑ ÎàåÎü¨ AI ÌåüÏ∫êÏä§Ìä∏Î•º ÏãúÏûëÌïòÏÑ∏Ïöî'
            );
        }

        function showLoadingStatus() {
            showStatusMessage(
                'ÏΩòÌÖêÏ∏† Î°úÎî© Ï§ë...', 
                'fas fa-spinner fa-spin',
                'Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî'
            );
        }

        function showEmptyStatus() {
            showStatusMessage(
                'Ïò§ÎîîÏò§ ÎåÄÍ∏∞ Ï§ë', 
                'fas fa-headphones',
                'ÏÑ§Ï†ïÏóêÏÑú ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÍ±∞ÎÇò Í∏∞Î≥∏ ÏΩòÌÖêÏ∏†Î•º Î°úÎìúÌïòÏÑ∏Ïöî'
            );
        }

        function hideStatusMessage() {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.style.display = 'none';
        }

        function updateTimeDisplay() {
            if (!filesLoaded || !audioPlayer) return;
            
            const current = audioPlayer.currentTime || 0;
            const duration = audioPlayer.duration || 0;
            
            // Update time displays
            document.getElementById('currentTime').textContent = formatTime(current);
            document.getElementById('totalTime').textContent = formatTime(duration);
            
            // Update timeline progress
            if (duration > 0) {
                const progress = (current / duration) * 100;
                document.getElementById('timelineProgress').style.width = `${progress}%`;
                document.getElementById('timelineSlider').value = progress;
                
                // Update waveform progress indicator
                const progressIndicator = document.getElementById('progressIndicator');
                if (progressIndicator) {
                    progressIndicator.style.left = `${progress}%`;
                }
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function handleAudioEnd() {
            // Clear all active subtitles
            clearSubtitleDisplay();
            window.currentGroupIndex = -1;
            
            // Show completion message
            showStatusMessage(
                'Ïû¨ÏÉù ÏôÑÎ£å', 
                'fas fa-check-circle',
                'ÌåüÏ∫êÏä§Ìä∏Í∞Ä ÎÅùÎÇ¨ÏäµÎãàÎã§. Îã§Ïãú Ïû¨ÏÉùÌïòÎ†§Î©¥ Ïû¨ÏÉù Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî'
            );
            
            console.log('üé¨ Audio playback completed');
        }

        function resetApplication() {
            // Stop audio
            if (audioPlayer) {
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
            }
            
            // Clear data
            conversationData = [];
            window.cinematicGroups = [];
            window.currentGroupIndex = -1;
            filesLoaded = false;
            
            // Clear UI (force immediate clear)
            clearSubtitleDisplay(true);
            
            // Reset file inputs
            document.getElementById('audioFile').value = '';
            document.getElementById('jsonFile').value = '';
            
            // Reset file labels
            document.querySelectorAll('.file-input-label').forEach(label => {
                label.classList.remove('has-file');
                const textSpan = label.querySelector('.file-input-text');
                textSpan.textContent = textSpan.dataset.default;
            });
            
            // Reset speaker names
            document.getElementById('speaker1Name').value = 'Ïù∏Í∞Ñ';
            document.getElementById('speaker2Name').value = 'AI';
            speakerNames = { 1: 'Ïù∏Í∞Ñ', 2: 'AI' };
            
            // Show reset status
            showStatusMessage(
                'Ï¥àÍ∏∞Ìôî ÏôÑÎ£å', 
                'fas fa-redo',
                'Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§. ÏÉàÎ°úÏö¥ ÏΩòÌÖêÏ∏†Î•º Î°úÎìúÌï¥Ï£ºÏÑ∏Ïöî'
            );
            
            console.log('üîÑ Application reset completed');
        }
    </script>
</body>
</html>